#include "stm32f10x.h"

void system_clk_set(void){ 
	ErrorStatus HSEStartUpStatus;
RCC_DeInit();
 
  /*????????(HSE)*/
  RCC_HSEConfig(RCC_HSE_ON);   //RCC_HSE_ON——HSE????(ON)
 
  /*??HSE??*/
  HSEStartUpStatus = RCC_WaitForHSEStartUp();
 
  if(HSEStartUpStatus == SUCCESS)        //SUCCESS:HSE???????
  {
    /*??AHB??(HCLK)*/ 
    RCC_HCLKConfig(RCC_SYSCLK_Div1);  //RCC_SYSCLK_Div1——AHB??= ????
 
    /* ????AHB??(PCLK2)*/ 
    RCC_PCLK2Config(RCC_HCLK_Div1);   //RCC_HCLK_Div1——APB2??= HCLK
 
    /*????AHB??(PCLK1)*/    
RCC_PCLK1Config(RCC_HCLK_Div2);   //RCC_HCLK_Div2——APB1??= HCLK / 2
 
    /*??FLASH??????????*/
    FLASH_SetLatency(FLASH_Latency_2);    //FLASH_Latency_2  2????
   
 /*??FLASH????????*/  
    FLASH_PrefetchBufferCmd(FLASH_PrefetchBuffer_Enable);       // ???????
 
    /*??PLL????????*/ 
    RCC_PLLConfig(RCC_PLLSource_HSE_Div1, RCC_PLLMul_9);     
// PLL?????= HSE????;RCC_PLLMul_9——PLL????x 9
   
  /*??PLL */
    RCC_PLLCmd(ENABLE); 
 
    /*?????RCC???(PLL?????)????*/   
    while(RCC_GetFlagStatus(RCC_FLAG_PLLRDY) == RESET)      
       {
       }
 
    /*??????(SYSCLK)*/ 
    RCC_SYSCLKConfig(RCC_SYSCLKSource_PLLCLK); 
//RCC_SYSCLKSource_PLLCLK——??PLL??????
 
    /* PLL????????????*/
    while(RCC_GetSYSCLKSource() != 0x08)        //0x08:PLL??????
       { 
       }
     }
 
 /*??????APB2????*/    
  RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA | RCC_APB2Periph_GPIOB | 
RCC_APB2Periph_GPIOC , ENABLE); 
//RCC_APB2Periph_GPIOA    GPIOA??
//RCC_APB2Periph_GPIOB    GPIOB??
//RCC_APB2Periph_GPIOC    GPIOC??
//RCC_APB2Periph_GPIOD    GPIOD??
}